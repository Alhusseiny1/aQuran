"use strict";!function(){function e(e){return["$rootScope","$window",function(n,o){for(var a,r,t,l=o[e]||(console.warn("This browser does not support Web Storage!"),{}),u={$default:function(e){for(var n in e)angular.isDefined(u[n])||(u[n]=e[n]);return u},$reset:function(e){for(var n in u)"$"===n[0]||delete u[n];return u.$default(e)}},g=0;g<l.length;g++)(t=l.key(g))&&"ngStorage-"===t.slice(0,10)&&(u[t.slice(10)]=angular.fromJson(l.getItem(t)));return a=angular.copy(u),n.$watch(function(){r||(r=setTimeout(function(){if(r=null,!angular.equals(u,a)){angular.forEach(u,function(e,n){angular.isDefined(e)&&"$"!==n[0]&&l.setItem("ngStorage-"+n,angular.toJson(e)),delete a[n]});for(var e in a)l.removeItem("ngStorage-"+e);a=angular.copy(u)}},100))}),"localStorage"===e&&o.addEventListener&&o.addEventListener("storage",function(e){"ngStorage-"===e.key.slice(0,10)&&(e.newValue?u[e.key.slice(10)]=angular.fromJson(e.newValue):delete u[e.key.slice(10)],a=angular.copy(u),n.$apply())}),u}]}angular.module("ngStorage",[]).factory("$localStorage",e("localStorage")).factory("$sessionStorage",e("sessionStorage"))}();
angular.module("audioPlayer",[]).directive("audioPlayer",["$rootScope","$log","$interpolate","$timeout","throttle",function(e,t,a,n,i){var r=function(e,t,a,n){return this instanceof r?(n=n||{},a=a||[],angular.extend(this,{_element:e,_audioTag:e[0],_scope:t,_playlist:a,name:n.name||"audioplayer",playing:!1,currentTrack:0,tracks:a.length,volume:e[0].volume,muted:e[0].muted,duration:e[0].duration,currentTime:e[0].currentTime,buffered:e[0].buffered,played:e[0].played,seekable:e[0].seekable,formatDuration:"",formatTime:"",loadPercent:0,position:e[0].currentTime}),void(this._unbindListeners=this._bindListeners(t))):new r(e,t,a,n)};return r.prototype={load:function(e,t){if("boolean"==typeof e?(t=e,e=null):"object"==typeof e&&(this._clearAudioList(),this._addAudioList(e)),this._scope.$emit(this.name+":load",t),this._audioTag.load(),t){var a=this;a._element.bind("canplaythrough",function(){a.play(),a._element.unbind("canplaythrough")})}},play:function(e){return this._playlist.length>e?(this.currentTrack=e+1,this.load(this._playlist[e],!0)):(!this.currentTrack&&this._audioTag.readyState&&this.currentTrack++,void this._audioTag.play())},playPause:function(e){"number"==typeof e&&e+1!==this.currentTrack?this.play(e):this.playing?this.pause():this.play()},pause:function(){this._audioTag.pause()},toggleMute:function(){this.muted=this._audioTag.muted=!this._audioTag.muted},next:function(e){var t=this;if(t.currentTrack&&t.currentTrack<t.tracks){var a=e||t.playing;t.pause(),n(function(){t._clearAudioList(),t._addAudioList(t._playlist[t.currentTrack]),t.load(a),t.currentTrack++})}},prev:function(e){var t=this;if(t.currentTrack&&t.currentTrack-1){var a=e||t.playing;t.pause(),n(function(){t._clearAudioList(),t._addAudioList(t._playlist[t.currentTrack-2]),t.load(a),t.currentTrack--})}},_addAudioList:function(e){var t=this;if(angular.isArray(e))angular.forEach(e,function(e){var n=angular.element(a('<source src="{{ src }}" type="{{ type }}" media="{{ media }}">')(e));t._element.append(n)});else if(angular.isObject(e)){var n=angular.element(a('<source src="{{ src }}" type="{{ type }}" media="{{ media }}">')(e));t._element.append(n)}},_clearAudioList:function(){this._element.contents().remove()},_formatTime:function(e){var t,a=parseInt(e/3600,10)%24,n=parseInt(e/60,10)%60,i=parseInt(e%60,10),r=(10>n?"0"+n:n)+":"+(10>i?"0"+i:i);return t=a>0?(10>a?"0"+a:a)+":"+r:r},_bindListeners:function(e){var t=this,a=this._element,n=i(1e3,!1,function(){e.$apply(function(){t.currentTime=t.position=t._audioTag.currentTime,t.formatTime=t._formatTime(t.currentTime)})}),r=function(a){return function(){e.$apply(function(){t.playing=a}),a?e.$emit(t.name+":play",t.currentTrack-1):e.$emit(t.name+":pause")}},u=function(){e.$apply(function(){t.currentTrack||t.currentTrack++,t.duration=t._audioTag.duration,t.formatDuration=t._formatTime(t.duration),t.loadPercent=parseInt(t._audioTag.buffered.end(t._audioTag.buffered.length-1)/t.duration*100,10)})},o=function(){t.next(!0)},d=function(){t._audioTag.buffered.length&&e.$apply(function(){t.loadPercent=parseInt(t._audioTag.buffered.end(t._audioTag.buffered.length-1)/t.duration*100,10)})};return a.bind("playing",r(!0)),a.bind("pause",r(!1)),a.bind("ended",o),a.bind("timeupdate",n),a.bind("loadedmetadata",u),a.bind("progress",d),function(){a.unbind("playing"),a.unbind("pause"),a.unbind("ended"),a.unbind("timeupdate"),a.unbind("loadedmetadata"),a.unbind("progress")}}},{scope:{exposedPlayer:"=playerControl",playlist:"=playlist"},link:function(e,a){function i(a,i){var r,u=e.exposedPlayer,o=null;if(void 0===a)return void 0!==i?(u.pause(),t.debug("playlist was deleted from scope, pausing and returning")):t.error("if you use playlist attribute, you need $scope.playlistVariable = []; in your code");if(u.currentTrack){r=i?i[u.currentTrack-1]:-1;for(var d=0;d<a.length;d++)if(angular.equals(a[d],r)){o=d;break}null!==o?(u.currentTrack=o+1,u.tracks=a.length):(u.pause(),a.length&&n(function(){u._clearAudioList(),u._addAudioList(a[0]),u.load(),u.tracks=a.length}))}else a.length&&(u._clearAudioList(),u._addAudioList(a[0]),u.load(),u.tracks=a.length)}if("AUDIO"!==a[0].tagName)return t.error("audioPlayer directive works only when attached to an <audio> type tag");var u=[],o=a.find("source"),d=e.playlist||[];angular.forEach(o,function(e){u.push({src:e.src,type:e.type,media:e.media})}),u.length&&d.unshift(u),e.exposedPlayer=new r(a,e,d),e.$emit(e.exposedPlayer.name+":ready",e.exposedPlayer),e.$watch("playlist",i,!0),e.$on("$destroy",function(){e.exposedPlayer._unbindListeners()})}}}]),angular.module("audioPlayer").factory("throttle",["$timeout",function(e){return function(t,a,n,i){var r,u=0;"boolean"!=typeof a&&(i=n,n=a,a=void 0);var o=function(){var o=this,d=+new Date-u,l=arguments,s=function(){u=+new Date,n.apply(o,l)},c=function(){r=void 0};i&&!r&&s(),r&&e.cancel(r),void 0===i&&d>t?s():a!==!0&&(r=e(i?c:s,void 0===i?t-d:t))};return o}}]);